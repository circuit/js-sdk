<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Circuit OAuth2 Example</title>
    <script src="https://circuitdev.unify.com:8094/circuit.js"></script>
  </head>
  <body>
    <button id="connect">Get my Circuit Conversations</button>
    <button id="refresh">Refresh page</button>
    <button id="logout">Logout</button>
    <pre id="result"></pre>

    <script type="text/javascript">

    var connectButton = document.getElementById('connect');
    var refreshButton = document.getElementById('refresh');
    var logoutButton = document.getElementById('logout');
    var result = document.getElementById('result');
    refreshButton.style.display = 'none';
    logoutButton.style.display = 'none';

    var client = new Circuit.Client({
        domain: 'circuitdev.unify.com:8094',
        client_id: 'ec900aca98ba4c62822af8240d712aaf',
        redirect_uri: 'https://localhost:7005/examples/redirect.html',
        scope: 'READ_USER_PROFILE,WRITE_USER_PROFILE'
    });

    connectButton.addEventListener('click', () => {
        client.logon()
        .then(user => {
            result.innerHTML = 'Successfully authenticated as ' + user.displayName;
            connectButton.style.display = 'none';
            refreshButton.style.display = '';
            logoutButton.style.display = '';
        })
        .then(client.getConversations)
        .then((conversations) => conversations.forEach(c => result.innerHTML += '<br>' + c.convId))
        .catch(err => {
            result.innerHTML = 'Something went wrong.<br><pre>' + JSON.stringify(err) + '</pre>';
        });
    });

    logoutButton.addEventListener('click', () => {
        client.logout().then(() => {
            refreshButton.style.display = 'none';
            logoutButton.style.display = 'none'
            connectButton.style.display = '';
            result.innerHTML = '';
        });
    });

    refreshButton.addEventListener('click', () => {
        location.reload(false);
    });
    </script>
  </body>
</html>
